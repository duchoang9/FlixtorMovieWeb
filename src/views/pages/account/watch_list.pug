html(lang="en")
  head
    title= title
    link(href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css", rel="stylesheet")
    link(rel="stylesheet" type="text/css" href="/css/edit-profile.css")
  body
    .container
      .row
        .col-md-4
          .user-info
            if user
              h3= user.user_name
              p= user.email
              p= `${user.numMovies} movies in watch list`
            else
              p Please log in to view your watch list.
        .col-md-8
          if !watchList || watchList.length === 0
            p No movies in watch list
          else
            each movie in watchList
              .movie-item
                img(src=movie.image_url, alt=movie.title, width="150px")
                .movie-details
                  h5= movie.title
                  p= `Released: ${movie.release_year}`
                  p= `IMDb Rating: ${movie.rating}`
                  button.remove-movie(data-watchlist-item-id=movie.id) Remove
    script(src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js")
    script.
      const removeMovieButtons = document.querySelectorAll('.remove-movie');
      removeMovieButtons.forEach(button => {
        button.addEventListener('click', async (e) => {
          const watchListItemId = e.target.dataset.watchlistItemId;
          try {
            const response = await fetch(`/watch_list/remove/${watchListItemId}`, {
              method: 'POST'
            });
            const message = await response.text();
            alert(message);
            location.reload();
          } catch (err) {
            console.error(err);
            alert('Error removing movie from watch list');
          }
        });
      });